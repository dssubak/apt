<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>광주수박등위브</title>
  <style>
    :root{
      --page-pad: 16px;
      --site-title-size: 18px;

      --cell-w: 92px;
      --cell-h: 36px;
      --cell-font: 14px;

      --cell-gap-x: 10px;
      --cell-gap-y: 10px;

      --dong-border: 1px;
      --dong-radius: 14px;
      --dong-pad: 14px;

      --pick-gap: 14px;
      --pick-card-h: 96px;
    }

    body{
      margin: var(--page-pad);
      font-family: system-ui, -apple-system, "Noto Sans KR", Segoe UI, Roboto, sans-serif;
      background:#fff;
      color:#000;
    }

    h1{
      margin: 0 0 14px;
      font-size: var(--site-title-size);
      font-weight: 900;
    }

    .topbar{
      display:flex;
      align-items:center;
      gap:10px;
      margin: 0 0 12px;
    }
    .btn{
      border:1px solid #000;
      background:#fff;
      padding: 8px 10px;
      cursor:pointer;
      text-decoration:none;
      color:#000;
      font-weight: 800;
      border-radius: 10px;
      display:inline-flex;
      align-items:center;
      gap:8px;
    }

    /* ✅ 기본은 동 선택 화면이 보이게(중요) */
    #pickView{ display:block; }
    #buildingView{ display:none; }

    .pickGrid{
      display:grid;
      gap: var(--pick-gap);
      grid-template-columns: repeat(2, minmax(0, 1fr));
      max-width: 1100px;
    }
    @media (min-width: 720px){
      .pickGrid{ grid-template-columns: repeat(3, minmax(0, 1fr)); }
    }
    @media (min-width: 1100px){
      .pickGrid{ grid-template-columns: repeat(6, minmax(0, 1fr)); }
    }

    .pickCard{
      height: var(--pick-card-h);
      border: 1px solid #d9d9d9;
      border-radius: 14px;
      background:#fff;
      cursor:pointer;
      user-select:none;
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight: 900;
      font-size: 20px;
      box-shadow: 0 1px 0 rgba(0,0,0,0.03);
    }
    .pickCard:hover{ background:#f7f7f7; }

    .dongWrap{
      border: var(--dong-border) solid #d9d9d9;
      border-radius: var(--dong-radius);
      padding: var(--dong-pad);
      background: #fff;
      width: max-content;
      max-width: 100%;
    }

    .dongInner{
      display:flex;
      flex-direction:column;
      align-items:center;
    }

    .dongLabel{
      margin-bottom: 10px;
      font-size: 18px;
      font-weight: 900;
      text-align: center;
      line-height: 1;
      border: none;
      background: transparent;
      padding: 0;
    }

    table.grid{
      border-collapse: separate;
      border-spacing: var(--cell-gap-x) var(--cell-gap-y);
      background:#fff;
    }
    table.grid td{
      padding: 0;
      width: var(--cell-w);
      height: var(--cell-h);
    }

    .cell{
      width: var(--cell-w);
      height: var(--cell-h);
      border: 1px solid #dcdcdc;
      border-radius: 8px;
      background: #fff;
      display:flex;
      align-items:center;
      justify-content:center;
      cursor: pointer;
      user-select: none;
      box-shadow: 0 1px 0 rgba(0,0,0,0.03);
    }

    /* ✅ 없는 칸은 숨김(자리 유지) */
    .cell.na{
      visibility: hidden;
      pointer-events: none;
    }

    .label{
      font-size: var(--cell-font);
      font-weight: 800;
      letter-spacing: .2px;
      white-space: nowrap;
      color:#000;
    }
  </style>
</head>
<body>
  <h1>광주수박등위브</h1>

  <!-- ✅ 초기: 동 선택 화면 -->
  <section id="pickView">
    <div class="pickGrid" id="pickGrid"></div>
  </section>

  <!-- ✅ 동 클릭 후: 해당 동 호수표 화면 -->
  <section id="buildingView">
    <div class="topbar">
      <a class="btn" href="#home">← 동 선택으로</a>
    </div>
    <div id="buildingMount"></div>
  </section>

<script>
const CONFIG = {
  "101동": { lines: { 1:[2,20], 2:[2,20], 3:[2,20] } },
  "102동": { lines: { 1:[2,20], 2:[2,20], 3:[2,20], 4:[2,20] } },
  "103동": { lines: { 1:[1,20], 2:[1,20] } },
  "104동": { lines: { 1:[2,12], 2:[2,12] } },
  "105동": { lines: { 1:[1,20], 2:[1,20], 3:[2,19], 4:[2,18] } },
  "106동": { lines: { 1:[1,18], 2:[1,18], 3:[1,15] } },
};

const COLOR_MAP = {
  "101동": { 1: "#FFE26A", 2: "#B7F5A1", 3: "#B8D7FF" },
  "102동": { 1: "#B8D7FF", 2: "#B7F5A1", 3: "#B8D7FF", 4: "#FFB0B0" },
  "103동": { 1: "#B8D7FF", 2: "#B8D7FF" },
  "104동": { 1: "#FFE26A", 2: "#FFE26A" },
  "105동": { 1: "#B8D7FF", 2: "#B7F5A1", 3: "#B8D7FF", 4: "#FFB0B0" },
  "106동": { 1: "#B8D7FF", 2: "#D9D9D9", 3: "#B7F5A1" },
};

const pickView = document.getElementById("pickView");
const buildingView = document.getElementById("buildingView");
const pickGrid = document.getElementById("pickGrid");
const buildingMount = document.getElementById("buildingMount");

function makeUnit(floor, line){
  return (floor * 100 + Number(line)).toString();
}
function computeRanges(dong){
  const linesObj = CONFIG[dong].lines;
  const lines = Object.keys(linesObj).map(Number).sort((a,b)=>a-b);
  let minFloor = Infinity, maxFloor = -Infinity;
  for (const ln of lines){
    const [s,e] = linesObj[ln];
    minFloor = Math.min(minFloor, s);
    maxFloor = Math.max(maxFloor, e);
  }
  return { lines, minFloor, maxFloor };
}
function exists(dong, floor, line){
  const r = CONFIG[dong].lines[line];
  if (!r) return false;
  const [s,e] = r;
  return floor >= s && floor <= e;
}
function getGlobalMinMax(){
  let globalMax = -Infinity;
  for (const dong of Object.keys(CONFIG)){
    const { maxFloor } = computeRanges(dong);
    globalMax = Math.max(globalMax, maxFloor);
  }
  return { globalMin: 1, globalMax };
}
function getCellColor(dong, line){
  const m = COLOR_MAP[dong];
  return (m && m[line]) ? m[line] : "#FFFFFF";
}

/* ✅ 호수 클릭 시 이동(원하는 사이트로 바꿔) */
const BASE_URL = ""; // 예: "https://example.com/unit"
function onUnitClick(dong, floor, line){
  const unit = makeUnit(floor, line);
  const dongNum = dong.replace("동","");
  if (BASE_URL){
    window.location.href = `${BASE_URL}?dong=${dongNum}&floor=${floor}&unit=${unit}`;
  } else {
    alert(`${dong} ${unit}`); // BASE_URL 비어있을 때 확인용
  }
}

function renderPick(){
  pickGrid.innerHTML = "";
  const dongs = Object.keys(CONFIG).sort((a,b)=>a.localeCompare(b,"ko"));
  for (const d of dongs){
    const card = document.createElement("div");
    card.className = "pickCard";
    card.textContent = d;
    card.addEventListener("click", () => {
      location.hash = `b=${d.replace("동","")}`;
    });
    pickGrid.appendChild(card);
  }
}

function renderBuilding(dong){
  buildingMount.innerHTML = "";

  const { lines } = computeRanges(dong);
  const cols = lines.length;
  const { globalMin, globalMax } = getGlobalMinMax();

  const wrap = document.createElement("div");
  wrap.className = "dongWrap";

  const inner = document.createElement("div");
  inner.className = "dongInner";

  const label = document.createElement("div");
  label.className = "dongLabel";
  label.textContent = dong;
  label.style.width = `calc(var(--cell-w) * ${cols} + var(--cell-gap-x) * ${Math.max(0, cols-1)})`;

  const table = document.createElement("table");
  table.className = "grid";
  const tbody = document.createElement("tbody");

  for (let f = globalMax; f >= globalMin; f--){
    const tr = document.createElement("tr");
    for (const ln of lines){
      const td = document.createElement("td");
      const ok = exists(dong, f, ln);

      const cell = document.createElement("div");
      cell.className = "cell" + (ok ? "" : " na");

      if (!ok){
        cell.innerHTML = `<div class="label">&nbsp;</div>`;
      } else {
        const unit = makeUnit(f, ln);
        cell.innerHTML = `<div class="label">${unit}</div>`;
        cell.style.background = getCellColor(dong, ln);
        cell.addEventListener("click", () => onUnitClick(dong, f, ln));
      }

      td.appendChild(cell);
      tr.appendChild(td);
    }
    tbody.appendChild(tr);
  }

  table.appendChild(tbody);
  inner.appendChild(label);
  inner.appendChild(table);
  wrap.appendChild(inner);
  buildingMount.appendChild(wrap);
}

function showHome(){
  pickView.style.display = "block";
  buildingView.style.display = "none";
  renderPick();
}
function showBuilding(dong){
  pickView.style.display = "none";
  buildingView.style.display = "block";
  renderBuilding(dong);
}

function syncFromHash(){
  const h = location.hash.replace(/^#/, "");
  if (!h || h === "home"){
    showHome();
    return;
  }
  const m = h.match(/^b=(\d{3})$/);
  if (m){
    const dong = `${m[1]}동`;
    if (CONFIG[dong]) showBuilding(dong);
    else showHome();
    return;
  }
  showHome();
}

window.addEventListener("hashchange", syncFromHash);
document.addEventListener("DOMContentLoaded", () => {
  if (!location.hash) location.hash = "home";
  syncFromHash();
});
</script>
</body>
</html>
